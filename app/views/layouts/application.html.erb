<!DOCTYPE html>
<html>
  <head>
    <title>To-Do</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Ícones -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>
      :root {
        --bg-light: #f5f7fa;
        --text-dark: #1a1a1a;
        --card-bg: #fff;
        --navbar-bg: #003366;
        --btn-primary: #007bff;
        --btn-hover: #0056b3;

        /* Dark mode variables */
        --bg-dark: #121212;
        --text-light: #f5f5f5;
        --card-dark: #1e1e1e;
        --navbar-dark: #0a0a0a;
      }

      body {
        background-color: var(--bg-light);
        color: var(--text-dark);
        font-family: 'Roboto', sans-serif;
        transition: background-color 0.4s, color 0.4s;
      }

      .dark-mode body {
        background-color: var(--bg-dark);
        color: var(--text-light);
      }

      .navbar {
        background-color: var(--navbar-bg);
        transition: background-color 0.4s;
      }

      .dark-mode .navbar {
        background-color: var(--navbar-dark);
      }

      .card {
        border: none;
        border-radius: 12px;
        background-color: var(--card-bg);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s, background-color 0.4s;
      }

      .dark-mode .card {
        background-color: var(--card-dark);
        box-shadow: 0 2px 10px rgba(255, 255, 255, 0.05);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .btn-primary {
        background-color: var(--btn-primary);
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
        font-weight: 500;
        transition: background-color 0.3s, transform 0.2s;
      }

      .btn-primary:hover {
        background-color: var(--btn-hover);
        transform: scale(1.05);
      }

      .fade-in {
        animation: fadeInUp 0.6s ease-in-out both;
      }

      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* Dark mode button */
      .dark-toggle {
        background: none;
        border: none;
        color: white;
        font-size: 1.3rem;
        cursor: pointer;
        transition: transform 0.3s;
      }

      .dark-toggle:hover {
        transform: scale(1.2);
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark px-3">
      <a class="navbar-brand fw-bold" href="<%= lists_path %>">
        <i class="bi bi-check2-square"></i> To-Do
      </a>

      <div class="d-flex ms-auto align-items-center">
        <button id="darkModeToggle" class="dark-toggle me-3" title="Alternar modo escuro">
          <i class="bi bi-moon-fill"></i>
        </button>

        <% if current_user %>
          <span class="navbar-text me-3">
            Olá, <%= current_user.name %>
          </span>
          <%= link_to "Sair", logout_path, method: :delete, class: "btn btn-light btn-sm" %>
        <% end %>
      </div>
    </nav>

    <div class="container mt-5 fade-in">
      <% if notice %>
        <div class="alert alert-success text-center fade-in"><%= notice %></div>
      <% elsif alert %>
        <div class="alert alert-danger text-center fade-in"><%= alert %></div>
      <% end %>

      <%= yield %>
    </div>

    <script>
      // Dark mode toggle
      const toggle = document.getElementById('darkModeToggle');
      const icon = toggle.querySelector('i');
      const html = document.documentElement;

      // Load preference
      if (localStorage.getItem('theme') === 'dark') {
        html.classList.add('dark-mode');
        icon.classList.replace('bi-moon-fill', 'bi-sun-fill');
      }

      toggle.addEventListener('click', () => {
        html.classList.toggle('dark-mode');
        const dark = html.classList.contains('dark-mode');
        icon.classList.replace(dark ? 'bi-moon-fill' : 'bi-sun-fill', dark ? 'bi-sun-fill' : 'bi-moon-fill');
        localStorage.setItem('theme', dark ? 'dark' : 'light');
      });
    </script>
  </body>
</html>
