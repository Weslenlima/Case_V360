<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="text-primary fw-bold">Minhas Listas</h2>
  <%= link_to "➕ Nova Lista", new_list_path, class: "btn btn-primary" %>
</div>

<% if @lists.any? %>
  <div class="row gy-4">
    <% @lists.each do |list| %>
      <div class="col-md-6 col-lg-4">
        <div class="card p-3 shadow-sm">
          <!-- Título e descrição -->
          <h5 class="text-dark fw-bold"><%= list.title %></h5>
          <p class="text-muted mb-1"><%= list.description.presence || "Sem descrição" %></p>
          <p class="small text-secondary">Criada em <%= list.created_at.strftime("%d/%m/%Y") %></p>

          <!-- Tarefas -->
          <% if list.todos.any? %>
            <ul class="list-unstyled mt-2">
              <% list.todos.each do |todo| %>
                <li class="d-flex align-items-center mb-1 <%= 'text-decoration-line-through text-muted' if todo.completed %>" id="todo-<%= todo.id %>">
                  <%= check_box_tag "todo_#{todo.id}", todo.id, todo.completed, class: "form-check-input me-2 toggle-todo", data: { url: toggle_list_todo_path(list, todo) } %>
                  <span><%= todo.title %></span>
                  <% if todo.due_date.present? %>
                    <small class="text-muted ms-auto">Prazo: <%= todo.due_date.strftime("%d/%m/%Y") %></small>
                  <% end %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-muted small mt-2">Nenhuma tarefa ainda.</p>
          <% end %>

          <!-- Botões -->
          <div class="mt-3 d-flex gap-2">
            <%= link_to "✏️ Editar", edit_list_path(list), class: "btn btn-outline-primary btn-sm flex-grow-1" %>
            <%= link_to "🗑️ Excluir", list_path(list), method: :delete, data: { confirm: "Excluir esta lista?" }, class: "btn btn-outline-danger btn-sm flex-grow-1" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center text-muted mt-5">
    <p>Nenhuma lista criada ainda.</p>
  </div>
<% end %>

<!-- JS para marcar/desmarcar tarefas via AJAX -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.toggle-todo').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const url = checkbox.dataset.url;

        fetch(url, {
          method: 'PATCH',
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
            'Accept': 'application/javascript'
          }
        });
      });
    });
  });
</script>
